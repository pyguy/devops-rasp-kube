{
  "variables": {
    "ssh_key_src": "/build/.ssh/id_rsa.pub",
    "image_home_dir": "/home/pi",
    "filename": "{{env `RPI_HOSTNAME`}}"
  },
  "builders": [
    {
      "type": "arm-image",
      "iso_url": "https://downloads.raspberrypi.org/raspbian_lite_latest",
      "iso_checksum_type": "sha256",
      "iso_checksum": "12ae6e17bf95b6ba83beca61e7394e7411b45eba7e6a520f434b0748ea7370e8",
      "output_filename": "output-arm-image/{{user `filename`}}.img"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "script": "provision.sh"
    },
    {
      "type": "file",
      "source": "{{user `ssh_key_src`}}",
      "destination": "{{user `image_home_dir`}}/.ssh/authorized_keys"
    },
    {
      "type": "shell",
      "inline": "chown pi:pi -R {{user `image_home_dir`}}/.ssh"
    }
  ]
}